# 数据库缓存策略
以下是数据库与缓存的五种常见策略。
## 1缓存旁路
![](http://imgcom.static.suishenyun.net/202401231633094.png)
- 缓存旁路（Cache-Aside）
  - 在缓存旁路策略中，数据库缓存位于数据库旁边。
  - 当应用程序请求数据时，它会首先检查缓存
    - 如果缓存中存在数据（**缓存命中**），则会直接返回数据
    - 如果缓存中没有数据（**缓存未命中**），则应用程序将查询数据库，然后将数据存储在缓存中，并将其返回给应用程序，以供后续的查询使用。
  - 缓存旁路设计是一种优秀的通用缓存策略
    - 这种策略特别适用于读取密集的工作负载的应用程序
    - 它将经常读取的数据保持在附近，以满足众多的读取请求
  - 将缓存和数据库分开还带来了两个额外的好处
    - 在缓存出现故障的情况下，仍然可以从数据库中读取数据，从而增加了一定的弹性
    - 由于缓存与数据库分离，因此可以独立扩展缓存和数据库，从而提高了整个系统的可伸缩性
  - 注意
    - 缓存旁路策略主要缺点是数据库中的不一致性问题
      - 当应用程序更新数据库中的数据时，缓存中的数据将过时
      - 为了解决这个问题，我们可以使用缓存失效策略
    - 对于任何数据的写入操作，应用程序仍然会直接访问数据库


## 2读取穿透
![](http://imgcom.static.suishenyun.net/202401231640378.png)
- 读取穿透（Read-Through）
  - 在读取穿透缓存的策略中，缓存位于应用程序和数据库之间
  - 在这种策略下，应用程序总是与缓存进行读取交互
    - 当缓存命中时，数据会立即返回
    - 当缓存未命中时，缓存会从数据库中获取缺失的数据，然后将其返回给应用程序
  - 对于任何数据的写入操作，应用程序仍然会直接访问数据库


## 3写入穿透
![](http://imgcom.static.suishenyun.net/202401231644115.png)
- 写入穿透（Write-Through）
  - 写入穿透缓存策略不是直接将数据写入数据库，而是首先将数据写入缓存，然后缓存立即将数据写入数据库
- 写入穿透策略的好处在于，确保缓存中具有所有写入的数据，并且任何新的读取请求不会因为缓存从主数据库请求数据而遇到延迟。如果仅采用这种安排，缺点是会产生额外的写入延迟，因为操作必须经过缓存然后再写入数据库。尽管这应该是立即发生的，但仍然存在两次连续写入的情况。
- 真正的好处来自于将写入穿透与读取穿透缓存配对使用的策略。这种策略将采用读取穿透缓存策略的所有优点，并增加了消除数据不一致的潜在优势。通过使用这种组合策略，可以实现写入数据的高效缓存和读取数据的快速访问，同时保持数据的一致性。


## 4写入回写
![](http://imgcom.static.suishenyun.net/202401231704628.png)
- 写入回写（Write-Back）
  - 与写入穿透策略几乎完全相同，只有一个关键细节不同。在写回策略中，应用程序再次直接将数据写入缓存。然而，缓存不会立即将数据写入数据库，而是会延迟一段时间后再进行写入。
  - 通过在写入数据库时延迟而不是立即进行，可以减轻写入密集工作负载对缓存的压力。这使得写回和读取穿透的组合对于混合工作负载非常适用。这种组合确保最近写入的数据和访问的数据始终存在，并可通过缓存进行访问
  - 缓存到数据库写入的延迟可以改善整体写入性能，并且如果支持批处理，则可以减少总体写入量。这为一些成本节约和整体工作负载减轻带来了潜在的机会。然而，在缓存发生故障的情况下，这种延迟可能会导致可能数据丢失的风险，特别是如果批处理或延迟写入数据库尚未发生。
  - 写回策略的另一个缺点是，如果缓存发生故障，那么缓存中的数据可能会丢失。这种情况下，数据库中的数据将是最新的，但是缓存中的数据将是过时的。这种情况下，应用程序将无法从缓存中读取数据，直到缓存恢复正常为止。


## 5写入旁路
![](http://imgcom.static.suishenyun.net/202401231705682.png)
- 写入旁路（Write-Around）
  - 写入旁路缓存策略将与缓存旁路或读取穿透缓存策略相结合
  - 在这种情况下，数据总是被写入数据库，而读取的数据会被放入缓存
  - 如果发生缓存未命中，则应用程序会从数据库读取数据，然后更新缓存以备下次使用
- 这种特定的策略在数据仅被写入一次且不进行更新的情况下表现最佳。数据很少被读取或根本不被读取。