# ElasticSerach

> 引子：任何一个系统都避免不了搜索这一功能，归根结底数据库的CRUD就是数据库的SELECT，但是在数据量很大的情况下，若依旧使用mysql的like “%xxx%”对数据进行搜索，那么势必会造成全表扫描，进而导致数据查询变慢，这个时候就需要使用到搜索引擎来转门实现这一功能。

> **适用场景**：**非强事务ACID**场景皆可适用官网地址：https://www.elastic.co/cn/elasticsearch

## 介绍

**ElasticSearch**（简称ES）是一个分布式、Restful的搜索及分析服务器，设计用于分布式计算；能够达到实时搜索，稳定，可靠，快速。

ElasticSearch通常被用于具有**复杂搜索功能**和**分析需求**的应用程序的底层引擎

ElasticSearch是在Lucene基础之上构建，与Lucene核心库竞争的**优势在于：**

*   完美封装了Lucene核心库，设计了友好的Restful-API，开发者无需过多关注底层机制，开箱即用
    
*   分片与副本机制，直接解决了集群下性能与高可用问题
    

## 全文检索

**全文检索是一种通过对文本内容进行全面索引和搜索的技术**，它可以快速地在大量文本数据中查找包含特定关键词或短语的文档，并返回相关的搜索结果。全文检索广泛应用于各种信息管理系统和应用中，如搜索引擎、文档管理系统、电子邮件客户端、新闻聚合网站等。它可以帮助用户快速定位所需信息，提高检索效率和准确性。

### 全文检索原理

在全文检索中，首先需要对文本数据进行处理，包括**分词**、**去除停用词**等。

然后，对处理后的文本数据**建立索引**，索引会记录每个单词在文档中的位置信息以及其他相关的元数据，如**词频**、**权重**等。这个过程通常使用**倒排索引**（inverted index）来实现，倒排索引将单词映射到包含该单词的文档列表中，以便快速定位相关文档。

当用户发起搜索请求时，搜索引擎会根据用户提供的关键词或短语，在建立好的索引中查找匹配的文档。搜索引擎会根据索引中的信息计算文档的相关性，并按照相关性排序返回搜索结果。用户可以通过不同的搜索策略和过滤条件来精确控制搜索结果的质量和范围。

#### 正排索引

**正排索引**是将文档按顺序排列并进行编号的索引结构。每个文档都包含了完整的文本内容，以及其他相关的属性或元数据，如标题、作者、发布日期等。在正排索引中，可以根据文档编号或其他属性快速定位和访问文档的内容。正排索引适合用于需要对文档进行整体检索和展示的场景，但对于包含大量文本内容的数据集来说，正排索引的存储和查询效率可能会受到限制。

在**MySQL** 中通过 ID 查找就是一种正排索引的应用。

如果是用MySQL存储文章 ，我们应该会使用这样的 SQL 去查询：

select \* from t\_blog where content like "%Java设计模式%"

这种需要遍历所有的记录进行匹配（**全表扫描**），不但效率低，而且搜索结果不符合我们搜索时的期望。

#### 倒排索引

**倒排索引**是根据单词或短语建立的索引结构。它将每个单词映射到包含该单词的文档列表中。倒排索引的建立过程是先对文档进行分词处理，然后记录每个单词在哪些文档中出现，以及出现的位置信息。通过倒排索引，可以根据关键词或短语快速找到包含这些词语的文档，并确定它们的相关性。倒排索引适用于在大规模文本数据中进行关键词搜索和相关性排序的场景，它能够快速定位文档，提高搜索效率。

倒排索引的效率比RDBMS的B+树算法更高效。

## ES基本概念

### Cluster&Node

ES可以以单点或者集群方式运行，以一个整体对外提供search服务的所有节点组成cluster，组成这个cluster的各个节点叫做node

### Index

这是ES存储数据的地方，类似于关系数据库的database。

### Shards

索引分片，这是ES提供分布式搜索的基础，其含义为将一个完整的index分成若干部分存储在相同或不同的节点上，这些组成index的部分就叫做shard

### Replicas

索引副本，ES可以设置多个索引的副本

副本的作用

*   提高系统的容错性，当某个节点某个分片损坏或丢失时可以从副本中恢复
    
*   提高ES的查询效率，ES会自动对搜索请求进行负载均衡
    

### Recovery

代表数据恢复或叫数据重新分布，ES在有节点加入或退出时会根据机器的负载对索引分片进行重新分配，挂掉的节点重新启动时也会进行数据恢复。

### Gateway

ES索引快照的存储方式，ES默认是先把索引存放到内存中，当内存满了再持久化到本地硬盘。

gateway对索引快照进行存储，当这个ES集群关闭再重新启动时就会从Gateway中读取索引备份数据。

### Discovery.zen

代表ES的自动发现节点机制，ES是一个基于p2p的系统，它先通过广播寻找存在的节点，再通过多播协议来进行节点之间的通信，同时也支持点对点的交互

### Transport

代表ES内部节点或集群与客户端的交互方式，默认内部是使用TCP协议进行交互，同时也支持HTTP协议（JSON数据格式）

## 应用场景