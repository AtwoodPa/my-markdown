# 图解计算机网络

## 1、基础篇

### 1.1、TCP/IP网络模型
> Q：为什么要有网络模型？
> 
> A：由于不同设备之间通信的方式不同，为了兼容各式各样的设备，诞生了一套通用的网络协议。

#### 1.1.1、应用层
- 数据封装格式
  - 应用数据
- 数据单位
  - 消息或报文（message）
- 应用层是最上面一层，也是我们能够直接接触到的就是应用层（Application layer）
- 应用层只需要专注于为用户提供应用功能，比如 HTTP、FTP、Telnet、DNS、SMTP等。
- 应用层不需要去关注数据传输的细节，就类似于寄快递，只需要知道快递公司的名字就可以了，不需要知道快递公司的运输细节。

#### 1.1.2、传输层
- 应用层的数据会传递给传输层（Transport layer），传输层为应用层提供网络支持的。
- 数据封装格式
  - TCP头部 + 应用数据
- 数据单位
  - 段（segment）
- 传输层协议
  - TCP
    - TCP全称传输控制协议（Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议。
    - 在应用层中HTTP使用的就是TCP协议
    - **TCP特性**（为了保证数据包能可靠地传输给对方）
      - 流量控制
      - 拥塞控制
      - 超时重传
  - UDP
    - UDP全称用户数据报协议（User Datagram Protocol）是一种面向无连接的传输层通信协议。
    - 简单到只负责发送数据包，不保证数据包是否能抵达对方，但它实时性相对更好，传输效率也高。
#### 1.1.3、网络层
- 网络层（Network layer）主要负责为数据包选择路由（Routing）。
- 数据封装格式
  - IP头部 + TCP头部 + 应用数据
- 数据单位
  - 包（package）
- 网络层最常用的协议是IP协议
  - IP 协议
    - 会将传输层的报文作为数据部分，再加上 IP 包头组装成 IP 报文，如果 IP 报文大小超过 MTU（以太网中一般为 1500 字节）就会再次进行分片，得到一个即将发送到网络的 IP 报文。
    - 寻址
      - 告诉去往下一个目的地的该往那个方向走
    - 路由
      - 根据「下一个目的地」选择路径


#### 1.1.4、网络接口层
- 网络接口层（Network Interface layer）负责处理与物理层的数据通信，也就是说它负责处理与电缆（光纤）、网卡的数据通信。
- 经过网络层生成了 IP 头部之后，接下来要交给网络接口层（Link Layer）在 IP 头部的前面加上 MAC 头部，并封装成数据帧（Data frame）发送到网络上。
- 数据封装格式
  - 帧头 + IP头部 + TCP头部 + 应用数据 + 帧尾
- 数据单位
  - 帧（frame）

### 1.2、键入网址到网站显示，期间发生了什么？

#### 1.2.1、HTTP

> 1、浏览器第一步做的工作就是解析URL

- 解析URL
  - http: + // +  Web服务器 + / + 路径 + 文件名 
- 生成发送给Web服务器的请求信息
  - 请求报文
    - 请求行
      - 请求方法 + URL + HTTP版本
    - 消息头
      - 请求首部 + 字段值
    - 消息体
      - 数据
  - 响应报文
    - 状态行
      - HTTP版本 + 状态码 + 状态码描述
    - 消息头
      - 响应首部 + 字段值
    - 消息体
      - 数据
> 2、真实地址查询 => DNS

- 浏览器通过解析URL生成HTTP请求之后，需要查询服务器域名对应的ip地址，才能成功将数据发送到服务器上

> 3、通过DNS获取到真实ip地址之后，将HTTP传输的工作交给协议栈，这个节点产生数据包


> 4、数据包交由TCP协议进行传输（可靠传输 ）
- TCP传输数据之前，要先经过三次握手建立链接
  - 流程
    - 第一次握手
      - 客户端发送一个SYN包给服务器，请求建立连接
    - 第二次握手
      - 服务器收到SYN包之后，回复一个SYN+ACK包给客户端
    - 第三次握手
      - 客户端收到SYN+ACK包之后，回复一个ACK包给服务器，服务器收到ACK包之后，连接建立成功
  - 目的
    - 保证双方都有发送和接收数据的能力
> 5、TCP协议传输数据包之后，交给IP协议进行传输（寻址和路由）

- TCP在各种操作的时候，都需要IP协议来进行寻址&路由，以便将数据（网络包）成功的发送给通信对象
- 地址
  - 源地址IP，即是客户端输出的 IP 地址 
  - 目标地址，即通过 DNS 域名解析得到的 Web服务器IP地址

> 6、生成了 IP 头部之后，接下来网络包还需要在 IP 头部的前面加上 MAC 头部


> 7、最终将数据通过网卡将数据转换成电信号在网络上传输
